<?php

namespace Prj\Events;

/**
 * 成功绑卡事件处理类
 *
 * @author simon.wang
 */
use Lib\Misc\Result;
use Prj\Bll\Finals\UserFinal;
USE Prj\Loger;

class BindOk extends \Sooh2\EvtQue\EvtProcess{

    public function init($evtData)
    {
        Loger::$prefix = '['. get_called_class() .']';
        return parent::init($evtData); // TODO: Change the autogenerated stub
    }

    public function onEvt()
    {
        $msg = 'done';
        error_log("trace event on ".__CLASS__.' with data='. json_encode($this->evtData));
        $bindCouponMsg = $this->send_bind_coupon();
        $msg .= ',send_bind_coupon#' . $bindCouponMsg;

        return $msg;
    }

    /**
     * Hand 发送绑卡红包
     * @param string $userId
     * @return mixed
     */
    protected function send_bind_coupon($userId = ''){
        $userId = $userId ? $userId : $this->evtData->userId;
        $params = [
            'userId' => $userId,
            'actCode' => \Prj\Model\Activity::bind_code,
        ];
        $ret = \Prj\Bll\EventCoupon::getInstance()->sendCoupon($params);
        return $ret['message'];
    }

    public function test_send_bind_coupon($userId){
        return $this->send_bind_coupon($userId);
    }

}

