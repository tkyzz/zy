<?php
namespace Prj\Model;
/**
 * Created by PhpStorm.
 * User: amdin
 * Date: 2017/8/22
 * Time: 9:54
 */
class DataTmp extends _ModelBase
{
    public static $type_help = 'help'; //帮助中心
    public static $type_alert = 'alert'; //app首页弹窗
    public static $type_birth = 'birth'; //生日活动配置

    protected static $cache = [];

    public function onInit()
    {
        $this->className = "Manager";
        parent::onInit(); // TODO: Change the autogenerated stub
        $this->_tbName = "tb_data_tmp_0";
    }


    public static function getByBASE64($base64str)
    {
        $pkey = json_decode(hex2bin($base64str),true);
        return parent::getCopy($pkey);
    }

    public static function getPkey($base64str)
    {
        return json_decode(hex2bin($base64str),true);
    }

    /**
     * Hand 根据type获取一整套配置
     * @param $type
     * @return mixed
     */
    public static function getConfig($type){
        if(empty(self::$cache[$type])){
            $list = self::getRecords(null , ['type' => $type]);
            $kv = [];
            if($list){
                foreach ($list as $v){
                    $arr = json_decode($v['value']);
                    if(is_array($arr))$v['value'] = $arr;
                    $kv[$v['key']] = $v['value'];
                }
            }
            \Prj\Loger::outVal('DataTmp' , $kv);
            self::$cache[$type] = $kv;
        }
        return self::$cache[$type];
    }

    public static function getDataList($type){
        $data = self::getRecords('*',['type'=>$type]);
        return $data;
    }

}